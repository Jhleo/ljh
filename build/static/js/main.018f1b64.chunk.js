(this["webpackJsonpvote-frontend"]=this["webpackJsonpvote-frontend"]||[]).push([[0],{202:function(e,t,n){},223:function(e,t,n){},284:function(e,t,n){},285:function(e,t,n){},343:function(e,t,n){},344:function(e,t,n){},353:function(e,t,n){},354:function(e,t,n){},357:function(e,t,n){"use strict";n.r(t);var c=n(0),r=n.n(c),a=n(35),s=n.n(a),i=(n(202),n(22)),o=n.n(i),u=n(41),j=n(29),l=n(44),b=n(30),d=n.n(b),p=Object(c.createContext)();p.displayName="UserContext";var O=p;var h=n(43),x=n(361),f=n(362),m=n(113),v=(n(223),n(4));var g=function(e){var t=e.history,n=Object(c.useRef)(),r=Object(c.useRef)(),a=(Object(c.useContext)(O),Object(h.b)());function s(){return(s=Object(u.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:d.a.post("/account/login",{name:n.current.props.value,password:r.current.props.value}).then((function(e){a({type:"user-info",user:e.data}),t.push("/home")})).catch((function(e){alert(e.toString())}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(v.jsxs)(x.a,{name:"basic",initialValues:{remember:!0},requiredMark:!1,className:"loginPage",children:[Object(v.jsx)(x.a.Item,{label:"\u7528\u6237\u540d",name:"username",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u7528\u6237!"}],children:Object(v.jsx)(f.a,{ref:n,autoComplete:"off"})}),Object(v.jsx)(x.a.Item,{label:"\u5bc6\u7801",name:"password",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5bc6\u7801!"}],children:Object(v.jsx)(f.a.Password,{ref:r})}),Object(v.jsx)(x.a.Item,{children:Object(v.jsx)(m.a,{className:"LogBut",type:"primary",htmlType:"submit",onClick:function(){return s.apply(this,arguments)},children:"\u767b\u5f55"})})]})},y=n(49);n(284);var w=function(){var e=Object(c.useRef)(),t=Object(c.useRef)(),n=Object(c.useRef)(),r=Object(c.useRef)(""),a=Object(c.useRef)(""),s=Object(c.useState)(null),i=Object(y.a)(s,2),j=i[0],l=i[1];function b(){return(b=Object(u.a)(o.a.mark((function c(s){return o.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return s.preventDefault(),c.next=3,d.a.post("/account/register",{name:e.current.state.value,password:t.current.state.value,gender:r.current.checked?r.current.value:a.current.value,email:n.current.state.value,avatar:j});case 3:alert("ok");case 4:case"end":return c.stop()}}),c)})))).apply(this,arguments)}function p(){return(p=Object(u.a)(o.a.mark((function e(t){var n,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new FormData).set("file",t.target.files[0]),e.next=4,d.a.post("/upload",n);case 4:c=e.sent,l(c.data.url);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(v.jsxs)("div",{className:"registerWrap",children:[Object(v.jsxs)("div",{className:"nameInput",children:[Object(v.jsx)("span",{children:"\u7528\u6237\u540d:"}),Object(v.jsx)(f.a,{type:"text",ref:e})]}),Object(v.jsxs)("div",{children:[Object(v.jsx)("span",{children:"\u6027\u522b:  "}),Object(v.jsx)("input",{type:"radio",name:"a1",ref:r,value:"m"}),Object(v.jsx)("span",{children:"\u7537"}),Object(v.jsx)("input",{type:"radio",name:"a1",ref:a,value:"f"}),Object(v.jsx)("span",{children:"\u5973"})]}),Object(v.jsxs)("div",{children:[Object(v.jsx)("span",{children:"\u5bc6\u7801: "}),Object(v.jsx)(f.a,{type:"password",ref:t})]}),Object(v.jsxs)("div",{children:[Object(v.jsx)("span",{children:"\u90ae\u7bb1\uff1a"}),Object(v.jsx)(f.a,{type:"email",ref:n})]}),Object(v.jsxs)("div",{children:[Object(v.jsx)("span",{children:"\u5934\u50cf\uff1a"}),Object(v.jsx)(f.a,{type:"file",onChange:function(e){return p.apply(this,arguments)}})]}),Object(v.jsxs)("div",{children:[Object(v.jsx)("img",{src:j,style:{width:100,height:100,border:0}})," "]}),Object(v.jsx)(m.a,{type:"primary",htmlType:"submit",onClick:function(e){return b.apply(this,arguments)},children:"\u6ce8\u518c"})]})},k=(n(285),n(363)),N=k.a.Content;function C(){var e=Object(j.g)(),t=Object(h.c)((function(e){return e.user})),n=Object(h.c)((function(e){return e.triedLogin})),r=Object(h.b)();return Object(c.useEffect)((function(){Object(u.a)(o.a.mark((function c(){return o.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:if(!t){c.next=2;break}return c.abrupt("return");case 2:n&&e.push("/login"),t||r({type:"get-user-info"});case 4:case"end":return c.stop()}}),c)})))()}),[t,n]),Object(v.jsxs)("div",{children:[Object(v.jsx)(N,{className:"signalSelect",children:Object(v.jsx)("div",{children:Object(v.jsxs)(l.b,{to:"/create",children:[" ",Object(v.jsx)("img",{src:"./icons/signal.png"}),Object(v.jsx)("br",{})," ",Object(v.jsx)(m.a,{className:"signal",children:"\u5355\u9009\u6295\u7968"})]})})}),Object(v.jsx)(N,{className:"miltSelect",children:Object(v.jsx)("div",{children:Object(v.jsxs)(l.b,{to:"/create?multiSelect",children:["  ",Object(v.jsx)("img",{src:"./icons/mult.png"}),Object(v.jsx)("br",{}),Object(v.jsx)(m.a,{className:"signal2",children:"\u591a\u9009\u6295\u7968"})]})})})]})}var I=n(89),R=Object.create(null);var S=function(e){if(e in R)return R[e];throw function(e){return d.a.get("/vote/get/"+e)}(e).then((function(t){R[e]=t.data}))},L=n(189),F=n.n(L),M=n(190),U=n.n(M);n(343);function D(){var e=Object(j.i)(),t=Object(j.g)(),n=S(e.params.id),r=n.vote,a=n.options,s=Object(c.useState)(a),i=Object(y.a)(s,2),l=i[0],b=i[1];Object(c.useEffect)((function(){b(a)}),[a]);var O=Object(c.useContext)(p).userInfo;function h(){return(h=Object(u.a)(o.a.mark((function e(n,c){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(O){e.next=3;break}return t.push("/login"),e.abrupt("return");case 3:if(c){e.next=9;break}return e.next=6,d.a.post("/vote/voteup/"+n);case 6:console.log("vote ok"),e.next=12;break;case 9:return e.next=11,d.a.post("/vote/cancel/"+n);case 11:console.log("cancel ok");case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Object(c.useEffect)((function(){if(r.deadline>(new Date).toISOString()){var e=F()({});return e.emit("select root",r.id),e.on("voting info",(function(e){console.log(e),b(e)})),function(){return e.disconnect()}}}),[r.id]);var x=Object(c.useMemo)((function(){var e=l.reduce((function(e,t){return e.push.apply(e,Object(I.a)(t.Users)),e}),[]);return U()(e,"id")}),[l]);return Object(v.jsxs)("div",{children:[Object(v.jsx)("h1",{children:r.title}),Object(v.jsxs)("h2",{children:[r.desc,r.desc?"[\u591a\u9009]":"[\u5355\u9009]"]}),Object(v.jsx)("div",{className:"list",children:l.map((function(e,t){var n=e.Users.some((function(e){return O&&e.id==O.id}));return Object(v.jsxs)("div",{className:"list",children:[Object(v.jsx)("div",{className:"pin",children:Object(v.jsxs)("div",{className:"warp",children:[Object(v.jsx)("span",{children:e.content}),Object(v.jsx)("span",{children:n?"\u2705":""}),Object(v.jsxs)("span",{children:[" (",e.Users.length,"\u7968)"]}),Object(v.jsxs)("span",{children:["(",(e.Users.length/(100*x.length==0?1:x.length)*100).toFixed(2),"%)"]}),!r.anonymous&&Object(v.jsx)("span",{children:e.Users.map((function(e,t){return e.avatar?Object(v.jsx)("img",{src:e.avatar,style:{width:30,height:30,borderRadius:"9999px"}}):Object(v.jsx)("span",{style:{display:"inline-block",width:30,height:30,textAlign:"center",borderRadius:"9999px",border:"1px solid"},children:e.name.slice(0,1).toUpperCase()},t)}))})]})}),Object(v.jsx)(m.a,{onClick:function(){return function(e,t){return h.apply(this,arguments)}(e.id,n)},className:"content",children:"\u6295\u7968"})]},t)}))}),Object(v.jsx)("div",{className:"time",children:"\u6295\u7968\u622a\u6b62:"+r.deadline.slice(0,10).concat(" "+r.deadline.slice(11,16))})]})}var P=n(52),T=n(360),q=n(365),E=n(367),V=n(366),H=n(60),A=n.n(H);n(344);function Y(){var e=new URLSearchParams(Object(j.h)().search),t=Object(j.g)();function n(){return(n=Object(u.a)(o.a.mark((function n(c){var r;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,d.a.post("/vote/create",Object(P.a)(Object(P.a)({},c),{},{multiSelect:e.has("multiSelect")}));case 3:r=n.sent.data,t.push("/vote/"+r.id),n.next=10;break;case 7:n.prev=7,n.t0=n.catch(0),alert(n.t0);case 10:case"end":return n.stop()}}),n,null,[[0,7]])})))).apply(this,arguments)}return Object(v.jsxs)(x.a,{name:"basic",initialValues:{remember:!0},onFinish:function(e){return n.apply(this,arguments)},className:"Create",children:[Object(v.jsx)(x.a.Item,{label:"Title",name:"title",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6295\u7968\u6807\u9898"}],children:Object(v.jsx)(f.a,{})}),Object(v.jsx)(x.a.Item,{label:"Description",name:"desc",rules:[{required:!1,message:"\u8bf7\u8f93\u5165\u6295\u7968\u63cf\u8ff0"}],children:Object(v.jsx)(f.a,{})}),Object(v.jsx)(x.a.List,{name:"options",initialValue:["",""],children:function(e,t,n){var c=t.add,r=t.remove;n.errors;return Object(v.jsxs)(v.Fragment,{children:[e.map((function(t,n){return Object(v.jsxs)(x.a.Item,{label:0===n?"Options":"",required:!1,children:[Object(v.jsx)(x.a.Item,Object(P.a)(Object(P.a)({},t),{},{noStyle:!0,children:Object(v.jsx)(f.a,{placeholder:"option content",style:{width:"60%"}})}))," ",e.length>1?Object(v.jsx)(E.a,{className:"dynamic-delete-button",onClick:function(){return r(t.name)}}):null]},t.key)})),Object(v.jsx)(x.a.Item,{children:Object(v.jsx)(m.a,{type:"dashed",onClick:function(){return c()},style:{width:"60%"},icon:Object(v.jsx)(V.a,{}),children:"Add Option"})})]})}}),Object(v.jsx)(x.a.Item,{initialValue:A()().add(1,"days"),label:"DeadLine",name:"deadline",children:Object(v.jsx)(T.a,{format:"YYYY-MM-DD HH:mm",showTime:{format:"HH:mm"},style:{width:"50%"}})}),Object(v.jsx)(x.a.Item,{initialValue:!1,name:"anonymous",valuePropName:"checked",children:Object(v.jsx)(q.a,{children:"Anonymous"})}),Object(v.jsx)(x.a.Item,{initialValue:!1,name:"restricted",valuePropName:"checked",children:Object(v.jsx)(q.a,{children:"Restricted"})}),Object(v.jsx)(x.a.Item,{children:Object(v.jsx)(m.a,{type:"primary",htmlType:"submit",children:"Submit"})}),Object(v.jsx)(x.a.Item,{children:Object(v.jsx)("div",{className:"ab"})})]})}var B=n(137);n(353);function W(){var e=Object(c.useState)({row:[],count:10}),t=Object(y.a)(e,2),n=t[0],r=t[1],a=(function(){var e=Object(j.g)(),t=Object(h.c)((function(e){return e.user})),n=Object(h.c)((function(e){return e.triedLogin})),r=Object(h.b)();Object(c.useEffect)((function(){Object(u.a)(o.a.mark((function c(){return o.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:if(!t){c.next=2;break}return c.abrupt("return");case 2:n&&e.push("/login"),t||r({type:"get-user-info"});case 4:case"end":return c.stop()}}),c)})))()}),[t,n])}(),Object(c.useState)([])),s=Object(y.a)(a,2),i=s[0],b=s[1];if(!i)return Object(v.jsx)("div",{children:"loading..."});function p(e){var t=e.key,n=e.index,c=e.style;return n>=i.length?Object(v.jsx)("div",{style:c,children:"loading..."},t):Object(v.jsx)("div",{style:c,children:Object(v.jsx)(l.b,{to:"/vote/"+i[n].id,className:"wrap",children:i[n].title})},t)}return Object(v.jsx)("div",{children:Object(v.jsx)(B.a,{isRowLoaded:function(e){var t=e.index;return!!i[t]},loadMoreRows:function(e){var t=e.startIndex,n=e.stopIndex;return d.a.get("/vote/myvotes?startIndex=".concat(t,"&stopIndex=").concat(n)).then((function(e){r(e.data),i.splice.apply(i,[t,0].concat(Object(I.a)(e.data.rows))),b(Object(I.a)(i))})).catch((function(e){console.log(e)}))},rowCount:n.count,children:function(e){var t=e.onRowsRendered,c=e.registerChild;return Object(v.jsx)(B.b,{onRowsRendered:t,ref:c,width:300,height:300,rowCount:n.count,rowHeight:20,rowRenderer:p})}})})}n(354),k.a.Content;var J=function(){Object(j.g)();var e=Object(h.b)(),t=Object(h.c)((function(e){return e.user}));function n(){return(n=Object(u.a)(o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e({type:"logout"});case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return Object(c.useEffect)((function(){e({type:"get-user-info"})}),[]),Object(v.jsx)(O.Provider,{value:{userInfo:t},children:Object(v.jsxs)("div",{className:"App",children:[t?Object(v.jsxs)(v.Fragment,{children:[Object(v.jsxs)("div",{className:"foot",children:[t.avatar?Object(v.jsx)("img",{src:t.avatar,className:"avatar",alt:"\u5934\u50cf"}):Object(v.jsx)("span",{className:"avatar2",children:t.name.slice(0,1).toUpperCase()}),Object(v.jsx)(m.a,{size:"small",className:"logout",onClick:function(){return n.apply(this,arguments)},children:"\u9000\u51fa"})]}),Object(v.jsxs)("div",{className:"linkWap",children:[Object(v.jsxs)(l.c,{to:"/home",className:"home",alt:"home",children:["  ",Object(v.jsx)("img",{src:"./icons/newicon.png"})," ",Object(v.jsx)("img",{src:"./icons/newgrey.png"}),Object(v.jsx)("br",{}),"\u65b0\u5efa"]}),Object(v.jsxs)(l.c,{to:"/My",className:"Myvote",alt:"My",children:[Object(v.jsx)("img",{src:"./icons/myicon.png"}),Object(v.jsx)("img",{src:"./icons/mygrey.png"}),"  ",Object(v.jsx)("br",{}),"\u6211\u7684"]})]})]}):Object(v.jsx)(v.Fragment,{children:Object(v.jsxs)("div",{className:"linkWap",children:[Object(v.jsx)(l.c,{to:"/login",className:"login",children:"\u767b\u5f55"}),Object(v.jsx)(l.c,{to:"/register",className:"register",children:"\u6ce8\u518c"})]})}),Object(v.jsxs)(j.d,{children:[Object(v.jsx)(j.b,{path:"/",exact:!0,children:Object(v.jsx)(j.a,{to:"/home"})}),Object(v.jsx)(j.b,{path:"/home",component:C}),Object(v.jsx)(j.b,{path:"/login",component:g}),Object(v.jsx)(j.b,{path:"/register",component:w}),Object(v.jsx)(j.b,{path:"/create",component:Y}),Object(v.jsx)(j.b,{path:"/my",component:W}),Object(v.jsx)(j.b,{path:"/vote/:id",children:Object(v.jsx)(c.Suspense,{fallback:"loading...",children:Object(v.jsx)(D,{})})})]})]})})},z=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,368)).then((function(t){var n=t.getCLS,c=t.getFID,r=t.getFCP,a=t.getLCP,s=t.getTTFB;n(e),c(e),r(e),a(e),s(e)}))},G=n(136),K=n(195),Q=n(68),X=o.a.mark(ce),Z=o.a.mark(re),$=o.a.mark(ae),_=o.a.mark(se),ee=Object(K.a)(),te={user:null,votes:{},triedLogin:!1},ne=Object(G.b)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:te,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"user-info":return Object(P.a)(Object(P.a)({},e),{},{user:t.user});case"remove-user-info":return Object(P.a)(Object(P.a)({},e),{},{user:null});case"try-login-failed":return Object(P.a)(Object(P.a)({},e),{},{triedLogin:!0});default:return e}}),Object(G.a)(ee));function ce(e){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.a.get("/account/userinfo");case 3:return t=e.sent,e.next=6,Object(Q.a)({type:"user-info",user:t.data});case 6:e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(0),e.next=12,Object(Q.a)({type:"try-login-failed"});case 12:case"end":return e.stop()}}),X,null,[[0,8]])}function re(e){var t;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,d.a.post("/account/login",{name:e.name,password:e.password});case 3:return t=n.sent,n.next=6,Object(Q.a)({type:"user-info",user:t.data});case 6:n.next=11;break;case 8:throw n.prev=8,n.t0=n.catch(0),n.t0;case 11:case"end":return n.stop()}}),Z,null,[[0,8]])}function ae(e){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.get("/account/logout");case 2:return e.sent,e.next=5,Object(Q.a)({type:"remove-user-info"});case 5:case"end":return e.stop()}}),$)}function se(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Q.b)("get-user-info",ce);case 2:return e.next=4,Object(Q.b)("login",re);case 4:return e.next=6,Object(Q.b)("logout",ae);case 6:case"end":return e.stop()}}),_)}ee.run(se);n(356);s.a.render(Object(v.jsx)(r.a.StrictMode,{children:Object(v.jsx)(l.a,{children:Object(v.jsx)(h.a,{store:ne,children:Object(v.jsx)(J,{})})})}),document.getElementById("root")),z()}},[[357,1,2]]]);
//# sourceMappingURL=main.018f1b64.chunk.js.map