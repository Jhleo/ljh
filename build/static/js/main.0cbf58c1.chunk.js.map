{"version":3,"sources":["UserContext.js","Login.js","hooks.js","Register.js","Home.js","data-fetcher.js","ViewVote.js","CreateVote.js","My.js","App.js","reportWebVitals.js","store.js","index.js"],"names":["UserContext","createContext","displayName","Login","history","usernameRef","useRef","passwordRef","dispatch","useContext","useDispatch","a","axios","post","name","current","value","password","then","res","type","user","data","go","catch","e","alert","toString","ref","onClick","useInput","init","useState","setValue","checked","setChecked","onChange","useCallback","target","Register","gender","email","previewUrl","setPreviewUrl","preventDefault","avatar","fd","FormData","set","files","url","src","Home","useHistory","useSelector","state","tried","triedLogin","useEffect","push","to","voteCache","Object","create","voteFetcher","id","get","getVote","val","ViewVote","match","useRouteMatch","params","vote","options","optionsInfo","setOptionsInfo","userInfo","selected","console","log","deadline","Date","toISOString","socket","io","emit","on","info","disconnect","allUsers","useMemo","users","reduce","ary","option","Users","uniqBy","title","desc","map","idx","some","voteOption","content","length","toFixed","anonymous","style","width","height","borderRadius","display","border","slice","toUpperCase","CreateVote","query","URLSearchParams","useLocation","search","voteInfo","multiSelect","has","initialValues","remember","onFinish","Item","label","rules","required","message","List","initialValue","fields","add","remove","errors","field","index","noStyle","placeholder","MinusCircleOutlined","className","key","icon","PlusOutlined","moment","format","showTime","valuePropName","htmlType","My","row","count","voteData","setVoteData","useForceLogin","votes","setVotes","rowRenderer","isRowLoaded","loadMoreRows","startIndex","stopIndex","splice","rows","rowCount","onRowsRendered","registerChild","rowHeight","App","Provider","path","exact","component","fallback","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","getUserInfo","login","logout","rootSaga","saga","createSagaMiddleware","initialState","store","createStore","action","applyMiddleware","put","takeEvery","run","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.0cbf58c1.chunk.js","sourcesContent":["import { createContext,useContext } from 'react'\r\n\r\nconst UserContext = createContext()\r\nUserContext.displayName='UserContext'\r\nexport default UserContext\r\n\r\nexport function useUserInfo(){\r\n    var userCtx=useContext(UserContext)\r\n    return userCtx.userInfo\r\n}","import {useState,useEffect, useRef, useContext} from 'react'\r\nimport axios from 'axios'\r\nimport UserContext from './UserContext'\r\nimport { useDispatch } from 'react-redux'\r\n\r\nfunction Login({history}){\r\n    let usernameRef=useRef()\r\n    let passwordRef=useRef()\r\n    let userCtx=useContext(UserContext) \r\n    let dispatch = useDispatch()\r\n\r\n   async function login(){    \r\n    axios.post('/account/login', {\r\n        name: usernameRef.current.value,\r\n        password: passwordRef.current.value,\r\n      }).then(res => {\r\n        dispatch({\r\n          type: 'user-info',\r\n          user: res.data\r\n        })\r\n        history.go(-1)\r\n      }).catch(e => {\r\n        alert(e.toString())\r\n      })\r\n    }\r\n    return(\r\n        <div>\r\n                Username:<input type=\"text\" ref={usernameRef}/>\r\n                Password:<input type=\"password\" ref={passwordRef}/>\r\n                <button onClick={login}>Login</button>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Login","import { useState,useCallback,useEffect} from \"react\"\r\nimport { useLocation, useHistory } from 'react-router-dom'\r\nimport axios from 'axios'\r\nimport {useSelector,useDispatch} from 'react-redux'\r\nexport function useInput(init) {\r\n    let [value, setValue] = useState(init)\r\n    let [checked, setChecked] = useState(init)\r\n  \r\n    let onChange = useCallback(function (e) {\r\n      setValue(e.target.value)\r\n      setChecked(e.target.checked)\r\n    }, [])\r\n  \r\n    return {value, checked, onChange}\r\n  }\r\n  export function useQuery() {\r\n    return new URLSearchParams(useLocation().search);\r\n  }\r\n\r\n  export function useRequest(url){\r\n    let [data, setData] = useState(null)\r\n    let [loading, setLoading] = useState(true)\r\n  \r\n    useEffect(() => {\r\n      axios.get(url).then((res) => {\r\n        setData(res.data)\r\n        setLoading(false)\r\n      })\r\n    }, [url])\r\n  \r\n    return [data, loading]\r\n  }\r\n export function useForceLogin(){\r\n    let history = useHistory()\r\n  let user = useSelector(state => state.user)\r\n  let tried = useSelector(state => state.triedLogin)\r\n\r\n  let dispatch = useDispatch()\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      if (user) {\r\n        return\r\n      }\r\n      if (tried) {\r\n        history.push('/login')\r\n      }\r\n      if (!user) {\r\n        dispatch({type: 'get-user-info'})\r\n      }\r\n    })()\r\n  }, [user, tried])\r\n\r\n  return user\r\n  }","import axios from \"axios\"\r\nimport { useState } from \"react\"\r\nimport { useInput } from \"./hooks\"\r\n\r\n\r\nfunction Register(){\r\n    let name = useInput('')\r\n    let password = useInput('')\r\n    let gender=useInput('')\r\n    let email=useInput('')\r\n    let [previewUrl, setPreviewUrl] = useState(null)\r\n    async function register(e){\r\n        e.preventDefault()\r\n      await  axios.post('/account/register',{\r\n            name:name.value,\r\n            password:password.value,\r\n            gender:gender.value,\r\n            email:email.value,\r\n            avatar: previewUrl,\r\n        })\r\n        alert('ok')\r\n    }\r\n    async function upload(e) {\r\n        let fd = new FormData()\r\n        fd.set('file', e.target.files[0])\r\n        let res = await axios.post('/upload', fd)\r\n        setPreviewUrl(res.data.url)\r\n      }\r\n    return(\r\n        <from>\r\n        <div>\r\n                <div>Username:<input type=\"text\" {...name}/></div>\r\n                <div>Password:<input type=\"password\" {...password}/></div>\r\n                <div>Gender:<input type=\"text\" {...gender}/> </div>\r\n                <div>Email:<input type=\"text\" {...email}/> </div>\r\n                <div>Avatar:<input type=\"file\" onChange={upload}/></div>\r\n                <img src={previewUrl} />\r\n                <button onClick={register}>Register</button>\r\n        </div>\r\n        </from>\r\n    )\r\n}\r\n\r\nexport default Register","import { useEffect, useContext } from 'react'\r\nimport { Link,useHistory } from 'react-router-dom'\r\nimport UserContext from './UserContext'\r\nimport axios from 'axios'\r\nimport { useSelector, useDispatch } from 'react-redux'\r\nimport {useForceLogin} from './hooks'\r\n\r\nexport default function Home() {\r\n    let history=useHistory() \r\n    let user = useSelector(state => state.user)\r\n    let tried = useSelector(state => state.triedLogin)\r\n\r\n    let dispatch = useDispatch()\r\n\r\n    useEffect(() => {\r\n      (async () => {\r\n        if (user) {\r\n          return\r\n        }\r\n        if (tried) {\r\n          history.push('/login')\r\n        }\r\n        if (!user) {\r\n          dispatch({type: 'get-user-info'})\r\n        }\r\n      })()\r\n    }, [user, tried])\r\n    return(\r\n        <div>\r\n            <div><Link to=\"/create\">创建单选</Link></div>\r\n            <div><Link to=\"/create?multiSelect\">创建多选</Link></div>\r\n        </div>\r\n    )\r\n}\r\n","import axios from 'axios'\r\n\r\nconst voteCache = Object.create(null)\r\n\r\nfunction getVote(id) {\r\n    return axios.get('/vote/get/' + id)\r\n}\r\n\r\nexport const voteFetcher = {\r\n    read(id) {\r\n        if (id in voteCache) {\r\n            return voteCache[id]\r\n        } else {\r\n            throw getVote(id).then(val => {\r\n                voteCache[id] = val.data\r\n            })\r\n        }\r\n    }\r\n}","import axios from \"axios\"\r\nimport { Suspense, useEffect, useState,useMemo } from \"react\"\r\nimport {useRouteMatch,useHistory} from 'react-router'\r\nimport { voteFetcher } from './data-fetcher'\r\nimport io from 'socket.io-client'\r\nimport uniqBy from 'lodash/uniqBy'\r\nimport { useUserInfo } from './UserContext'\r\nexport default function ViewVote(){\r\n    let match = useRouteMatch()\r\n    let history = useHistory()\r\n    // let [voteData,setVoteData] = useState(null)\r\n    let { vote, options } = voteFetcher.read(match.params.id)\r\n    let [optionsInfo, setOptionsInfo] = useState(options)\r\n    useEffect(()=>{\r\n        setOptionsInfo(options)\r\n    },[options])\r\n\r\n    let userInfo=useUserInfo()\r\n    //向某个选项投票\r\n    /* id 选项id\r\n    * selected 当前用户是否选中该选项\r\n    */\r\n    async function voteOption(id,selected){\r\n        if (!userInfo) {\r\n            history.push('/login')\r\n            return\r\n          }\r\n        if (!selected) {\r\n            await axios.post('/vote/voteup/' + id)\r\n            console.log('vote ok')\r\n          } else {\r\n            await axios.post('/vote/cancel/' + id)\r\n            console.log('cancel ok')\r\n          }\r\n    }\r\n    useEffect(()=>{\r\n        //没过期 连接\r\n        if(vote.deadline>new Date().toISOString()){\r\n            let socket = io({\r\n                // transports:['websocket','polling']\r\n            })\r\n            socket.emit('select root', vote.id)\r\n            socket.on('voting info',info=>{\r\n                console.log(info)\r\n                setOptionsInfo(info)\r\n            })\r\n            return () => socket.disconnect()\r\n        }\r\n\r\n    },[vote.id])\r\n\r\n    let allUsers = useMemo(() => {\r\n        let users = optionsInfo.reduce((ary, option) => {\r\n          ary.push(...option.Users)\r\n          return ary\r\n        }, [])\r\n        let uniqUsers = uniqBy(users, 'id')\r\n        return uniqUsers\r\n      }, [optionsInfo])\r\n    return(\r\n        <div>\r\n            <h1>{vote.title}</h1>\r\n            <h2>{vote.desc}</h2>\r\n            {\r\n                optionsInfo.map((option,idx)=>{\r\n                    let selected=option.Users.some(user=>{return userInfo&&user.id==userInfo.id})\r\n                    return(\r\n                        <div key={idx}>\r\n                            <div onClick={()=>voteOption(option.id,selected)}>\r\n                                {option.content}\r\n                                -----\r\n                                {selected?'✅':''}\r\n                                -----\r\n                               ({option.Users.length}票)\r\n                               --------\r\n                               ({(option.Users.length / allUsers.length * 100).toFixed(2)}%)\r\n                            </div>\r\n                            {\r\n                                !vote.anonymous&&\r\n                                <div>\r\n                                    {\r\n                                        option.Users.map((user,idx)=>{\r\n                                            if(user.avatar){\r\n                                                return <img src={user.avatar} style={{width:30,height:30,borderRadius:'9999px'}}/>\r\n                                            }else{\r\n                                                return <span key={idx} style={{display:\"inline-block\",width:20,height:20,borderRadius:'9999px',border:'1px solid'}}>{user.name.slice(0,1).toUpperCase()}</span>\r\n                                            }\r\n                                            \r\n                                        })\r\n                                    }\r\n                                </div>\r\n                            }\r\n                        </div>\r\n                    )\r\n                })\r\n            }\r\n        </div>\r\n    )\r\n}","import { useQuery } from './hooks'\r\nimport axios from 'axios'\r\nimport { useHistory } from \"react-router-dom\"\r\nimport { Form, Input, Button, Checkbox, DatePicker } from 'antd';\r\nimport { MinusCircleOutlined, PlusOutlined } from '@ant-design/icons';\r\nimport moment from 'moment'\r\n\r\n\r\nexport default function CreateVote() {\r\n    var query = useQuery()\r\n    var history = useHistory()\r\n  \r\n    async function createVote(voteInfo) {\r\n      try {\r\n        var vote = (await axios.post('/vote/create', {\r\n          ...voteInfo,\r\n          multiSelect: query.has('multiSelect'),\r\n        })).data\r\n  \r\n        history.push('/vote/' + vote.id)\r\n      } catch (e) {\r\n        alert(e)\r\n      }\r\n    }\r\n    return(\r\n\r\n<Form\r\n      name=\"basic\"\r\n      initialValues={{ remember: true }}\r\n      onFinish={createVote}\r\n    >\r\n      <Form.Item\r\n        label=\"Title\"\r\n        name=\"title\"\r\n        rules={[{ required: true, message: '请输入投票标题' }]}\r\n      >\r\n        <Input />\r\n      </Form.Item>\r\n\r\n      <Form.Item\r\n        label=\"Description\"\r\n        name=\"desc\"\r\n        rules={[{ required: false, message: '请输入投票描述' }]}\r\n      >\r\n        <Input />\r\n      </Form.Item>\r\n      <Form.List\r\n        name=\"options\"\r\n        initialValue={['', '']}\r\n      >\r\n        {(fields, { add, remove }, { errors }) => (\r\n          <>\r\n            {fields.map((field, index) => (\r\n              <Form.Item\r\n                label={index === 0 ? 'Options' : ''}\r\n                required={false}\r\n                key={field.key}\r\n              >\r\n                <Form.Item\r\n                  {...field}\r\n                  noStyle\r\n                >\r\n                  <Input placeholder=\"option content\" style={{ width: '60%' }} />\r\n                </Form.Item>\r\n                {' '}\r\n                {fields.length > 1 ? (\r\n                  <MinusCircleOutlined\r\n                    className=\"dynamic-delete-button\"\r\n                    onClick={() => remove(field.name)}\r\n                  />\r\n                ) : null}\r\n              </Form.Item>\r\n            ))}\r\n            <Form.Item>\r\n              <Button\r\n                type=\"dashed\"\r\n                onClick={() => add()}\r\n                style={{ width: '60%' }}\r\n                icon={<PlusOutlined />}\r\n              >\r\n                Add Option\r\n              </Button>\r\n            </Form.Item>\r\n          </>\r\n        )}\r\n      </Form.List>\r\n\r\n      <Form.Item initialValue={moment().add(1, 'days')} label=\"DeadLine\" name=\"deadline\">\r\n        <DatePicker format=\"YYYY-MM-DD HH:mm\" showTime={{ format: 'HH:mm'}} />\r\n      </Form.Item>\r\n      <Form.Item initialValue={false} name=\"anonymous\" valuePropName=\"checked\">\r\n        <Checkbox>Anonymous</Checkbox>\r\n      </Form.Item>\r\n      <Form.Item initialValue={false} name=\"restricted\" valuePropName=\"checked\">\r\n        <Checkbox>Restricted</Checkbox>\r\n      </Form.Item>\r\n\r\n      <Form.Item>\r\n        <Button type=\"primary\" htmlType=\"submit\">\r\n          Submit\r\n        </Button>\r\n      </Form.Item>\r\n</Form>\r\n    )\r\n}","import axios from \"axios\"\r\nimport { useEffect, useState } from \"react\"\r\nimport { Link } from \"react-router-dom\"\r\nimport { useForceLogin } from \"./hooks\"\r\nimport { List, InfiniteLoader, AutoSizer} from 'react-virtualized';\r\nexport default function My(){\r\n    let [voteData, setVoteData] = useState({row: [], count: 10})\r\n    let user = useForceLogin()\r\n    let [votes, setVotes] = useState([])\r\n\r\n    if (!votes) {\r\n        return <div>loading...</div>\r\n      }\r\n\r\n\r\n      function loadMore({startIndex, stopIndex}) {\r\n        return axios.get(`/vote/myvotes?startIndex=${startIndex}&stopIndex=${stopIndex}`).then(res => {\r\n          setVoteData(res.data)//里面有总条目数\r\n          votes.splice(startIndex, 0, ...res.data.rows)\r\n          setVotes([...votes])\r\n        }).catch(e => {\r\n          console.log(e)\r\n        })\r\n      }\r\n    \r\n      function rowRenderer({ key, index, style }) {\r\n        // debugger\r\n        if (index >= votes.length) {\r\n          return <div style={style} key={key}>loading...</div>\r\n        }\r\n        return (\r\n          <div style={style} key={key}>\r\n            <Link to={\"/vote/\" + votes[index].id}>{votes[index].title}</Link>\r\n          </div>\r\n        )\r\n      }\r\n    \r\n      function isRowLoaded({ index }) {\r\n        return !!votes[index]\r\n      }\r\n    return (\r\n        <div>\r\n      <InfiniteLoader\r\n        isRowLoaded={isRowLoaded}\r\n        loadMoreRows={loadMore}\r\n        rowCount={voteData.count}\r\n      >\r\n        {({onRowsRendered, registerChild}) => (\r\n          <List\r\n            onRowsRendered={onRowsRendered}\r\n            ref={registerChild}\r\n            width={300}\r\n            height={300}\r\n            rowCount={voteData.count}\r\n            rowHeight={20}\r\n            rowRenderer={rowRenderer}\r\n          />\r\n        )}\r\n      </InfiniteLoader>\r\n    \r\n    </div>\r\n    )\r\n}","import { NavLink as Link,Switch,Route,Redirect,useHistory} from 'react-router-dom'\nimport Login from './Login'\nimport Register from './Register'\nimport Home from './Home'\nimport ViewVote from './ViewVote'\nimport UserContext from './UserContext'\nimport { Suspense, useState,useEffect } from 'react'\nimport axios from 'axios'\nimport CreateVote from './CreateVote'\nimport My from './My'\n\nimport {useSelector,useDispatch} from 'react-redux'\nfunction App() {\n  const history = useHistory()\n  const dispatch = useDispatch()\n  \n  const userInfo = useSelector(state => state.user)\n\n\n  async function logout(){\n    dispatch({type: 'logout'})\n  }\n  useEffect(()=>{   \n    dispatch({type: 'get-user-info'})\n},[])\n  return (\n    <UserContext.Provider value={{userInfo: userInfo}}>\n    <div className=\"App\">\n      {\n        userInfo?\n        <>\n        <span>欢迎,{userInfo.name}</span>\n        <Link to=\"/home\">创建</Link>\n        <Link to=\"/my\">我的</Link>\n        <button onClick={logout}>登出</button>\n        </>\n        :\n        <>\n        <Link to=\"/login\">登录</Link>\n        <Link to=\"/register\">注册</Link>\n        </>\n      }\n\n      <Switch>\n      <Route path=\"/\" exact>\n        <Redirect to=\"/home\"></Redirect>\n      </Route>\n        <Route path=\"/home\" component={Home}/>\n        <Route path=\"/login\" component={Login}/>\n        <Route path=\"/register\" component={Register}/>\n        <Route path=\"/create\" component={CreateVote}/>\n        <Route path=\"/my\" component={My}/>\n        <Route path=\"/vote/:id\">\n        <Suspense fallback={'loading...'}>\n          <ViewVote />\n        </Suspense>\n        </Route>\n      </Switch>\n    </div> \n    </UserContext.Provider>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import { createStore, applyMiddleware } from 'redux'\r\nimport createSagaMiddleware from 'redux-saga'\r\nimport { put, takeEvery, takeLatest, call } from 'redux-saga/effects'\r\nimport axios from 'axios'\r\n\r\nconst saga = createSagaMiddleware()\r\nconst initialState = {\r\n    user: null,\r\n    votes: {},\r\n    triedLogin: false,//尝试登陆但没成功时为真\r\n  }\r\n\r\nconst store=createStore((state= initialState,action)=>{\r\n      switch (action.type) {\r\n        case 'user-info':\r\n            return {\r\n              ...state,\r\n              user: action.user\r\n            }\r\n          case 'remove-user-info':\r\n            return {\r\n              ...state,\r\n              user: null\r\n            }\r\n          case 'try-login-failed':\r\n            return {\r\n              ...state,\r\n              triedLogin: true\r\n            }\r\n          default:\r\n            return state\r\n      }\r\n  },applyMiddleware(saga))\r\n\r\n  export default store\r\n\r\n  function* getUserInfo(action) {\r\n    try {\r\n      let res = yield axios.get('/account/userinfo')\r\n      yield put({type: 'user-info', user: res.data})\r\n    } catch (e) {\r\n      yield put({type: 'try-login-failed'})\r\n    }\r\n  }\r\n\r\nfunction* login(action) {\r\n    try {\r\n      let res = yield axios.post('/account/login', {\r\n        name: action.name,\r\n        password: action.password,\r\n      })\r\n      yield put({type: 'user-info', user: res.data})\r\n    } catch (e) {\r\n      throw e\r\n    }\r\n  }\r\nfunction* logout(action) {\r\n    let res = yield axios.get('/account/logout')\r\n    yield put({type: 'remove-user-info'})\r\n  }\r\n\r\nfunction* rootSaga() {\r\n  yield takeEvery('get-user-info', getUserInfo)\r\n  yield takeEvery('login', login)\r\n  yield takeEvery('logout', logout)\r\n}\r\n  saga.run(rootSaga)","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\nimport {HashRouter as Router} from 'react-router-dom';\nimport store from './store';\nimport {Provider} from 'react-redux'\nimport 'antd/dist/antd.css';\nReactDOM.render(\n  <React.StrictMode>\n    <Router>\n    <Provider store={store}>\n      <App />\n      </Provider>\n    </Router> \n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}