(this["webpackJsonpvote-frontend"]=this["webpackJsonpvote-frontend"]||[]).push([[0],{201:function(e,t,n){},349:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n.n(r),a=n(34),s=n.n(a),i=(n(201),n(21)),o=n.n(i),u=n(42),j=n(29),l=n(45),b=n(30),d=n.n(b),p=Object(r.createContext)();p.displayName="UserContext";var O=p;var h=n(44),f=n(8);var x=function(e){var t=e.history,n=Object(r.useRef)(),c=Object(r.useRef)(),a=(Object(r.useContext)(O),Object(h.b)());function s(){return(s=Object(u.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:d.a.post("/account/login",{name:n.current.value,password:c.current.value}).then((function(e){a({type:"user-info",user:e.data}),t.go(-1)})).catch((function(e){alert(e.toString())}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(f.jsxs)("div",{children:["Username:",Object(f.jsx)("input",{type:"text",ref:n}),"Password:",Object(f.jsx)("input",{type:"password",ref:c}),Object(f.jsx)("button",{onClick:function(){return s.apply(this,arguments)},children:"Login"})]})},v=n(39),m=n(50);function g(e){var t=Object(r.useState)(e),n=Object(m.a)(t,2),c=n[0],a=n[1],s=Object(r.useState)(e),i=Object(m.a)(s,2),o=i[0],u=i[1];return{value:c,checked:o,onChange:Object(r.useCallback)((function(e){a(e.target.value),u(e.target.checked)}),[])}}var y=function(){var e=g(""),t=g(""),n=g(""),c=g(""),a=Object(r.useState)(null),s=Object(m.a)(a,2),i=s[0],j=s[1];function l(){return(l=Object(u.a)(o.a.mark((function r(a){return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a.preventDefault(),r.next=3,d.a.post("/account/register",{name:e.value,password:t.value,gender:n.value,email:c.value,avatar:i});case 3:alert("ok");case 4:case"end":return r.stop()}}),r)})))).apply(this,arguments)}function b(){return(b=Object(u.a)(o.a.mark((function e(t){var n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new FormData).set("file",t.target.files[0]),e.next=4,d.a.post("/upload",n);case 4:r=e.sent,j(r.data.url);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(f.jsx)("from",{children:Object(f.jsxs)("div",{children:[Object(f.jsxs)("div",{children:["Username:",Object(f.jsx)("input",Object(v.a)({type:"text"},e))]}),Object(f.jsxs)("div",{children:["Password:",Object(f.jsx)("input",Object(v.a)({type:"password"},t))]}),Object(f.jsxs)("div",{children:["Gender:",Object(f.jsx)("input",Object(v.a)({type:"text"},n))," "]}),Object(f.jsxs)("div",{children:["Email:",Object(f.jsx)("input",Object(v.a)({type:"text"},c))," "]}),Object(f.jsxs)("div",{children:["Avatar:",Object(f.jsx)("input",{type:"file",onChange:function(e){return b.apply(this,arguments)}})]}),Object(f.jsx)("img",{src:i}),Object(f.jsx)("button",{onClick:function(e){return l.apply(this,arguments)},children:"Register"})]})})};function w(){var e=Object(j.g)(),t=Object(h.c)((function(e){return e.user})),n=Object(h.c)((function(e){return e.triedLogin})),c=Object(h.b)();return Object(r.useEffect)((function(){Object(u.a)(o.a.mark((function r(){return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!t){r.next=2;break}return r.abrupt("return");case 2:n&&e.push("/login"),t||c({type:"get-user-info"});case 4:case"end":return r.stop()}}),r)})))()}),[t,n]),Object(f.jsxs)("div",{children:[Object(f.jsx)("div",{children:Object(f.jsx)(l.b,{to:"/create",children:"\u521b\u5efa\u5355\u9009"})}),Object(f.jsx)("div",{children:Object(f.jsx)(l.b,{to:"/create?multiSelect",children:"\u521b\u5efa\u591a\u9009"})})]})}var k=n(88),C=Object.create(null);var I=function(e){if(e in C)return C[e];throw function(e){return d.a.get("/vote/get/"+e)}(e).then((function(t){C[e]=t.data}))},S=n(181),R=n.n(S),L=n(182),F=n.n(L);function U(){var e=Object(j.i)(),t=Object(j.g)(),n=I(e.params.id),c=n.vote,a=n.options,s=Object(r.useState)(a),i=Object(m.a)(s,2),l=i[0],b=i[1];Object(r.useEffect)((function(){b(a)}),[a]);var O=Object(r.useContext)(p).userInfo;function h(){return(h=Object(u.a)(o.a.mark((function e(n,r){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(O){e.next=3;break}return t.push("/login"),e.abrupt("return");case 3:if(r){e.next=9;break}return e.next=6,d.a.post("/vote/voteup/"+n);case 6:console.log("vote ok"),e.next=12;break;case 9:return e.next=11,d.a.post("/vote/cancel/"+n);case 11:console.log("cancel ok");case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Object(r.useEffect)((function(){if(c.deadline>(new Date).toISOString()){var e=R()({});return e.emit("select root",c.id),e.on("voting info",(function(e){console.log(e),b(e)})),function(){return e.disconnect()}}}),[c.id]);var x=Object(r.useMemo)((function(){var e=l.reduce((function(e,t){return e.push.apply(e,Object(k.a)(t.Users)),e}),[]);return F()(e,"id")}),[l]);return Object(f.jsxs)("div",{children:[Object(f.jsx)("h1",{children:c.title}),Object(f.jsx)("h2",{children:c.desc}),l.map((function(e,t){var n=e.Users.some((function(e){return O&&e.id==O.id}));return Object(f.jsxs)("div",{children:[Object(f.jsxs)("div",{onClick:function(){return function(e,t){return h.apply(this,arguments)}(e.id,n)},children:[e.content,"-----",n?"\u2705":"","----- (",e.Users.length,"\u7968) -------- (",(e.Users.length/x.length*100).toFixed(2),"%)"]}),!c.anonymous&&Object(f.jsx)("div",{children:e.Users.map((function(e,t){return e.avatar?Object(f.jsx)("img",{src:e.avatar,style:{width:30,height:30,borderRadius:"9999px"}}):Object(f.jsx)("span",{style:{display:"inline-block",width:20,height:20,borderRadius:"9999px",border:"1px solid"},children:e.name.slice(0,1).toUpperCase()},t)}))})]},t)}))]})}var D=n(354),P=n(355),E=n(112),H=n(353),M=n(357),N=n(358),T=n(359),V=n(60),A=n.n(V);function Y(){var e=new URLSearchParams(Object(j.h)().search),t=Object(j.g)();function n(){return(n=Object(u.a)(o.a.mark((function n(r){var c;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,d.a.post("/vote/create",Object(v.a)(Object(v.a)({},r),{},{multiSelect:e.has("multiSelect")}));case 3:c=n.sent.data,t.push("/vote/"+c.id),n.next=10;break;case 7:n.prev=7,n.t0=n.catch(0),alert(n.t0);case 10:case"end":return n.stop()}}),n,null,[[0,7]])})))).apply(this,arguments)}return Object(f.jsxs)(D.a,{name:"basic",initialValues:{remember:!0},onFinish:function(e){return n.apply(this,arguments)},children:[Object(f.jsx)(D.a.Item,{label:"Title",name:"title",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6295\u7968\u6807\u9898"}],children:Object(f.jsx)(P.a,{})}),Object(f.jsx)(D.a.Item,{label:"Description",name:"desc",rules:[{required:!1,message:"\u8bf7\u8f93\u5165\u6295\u7968\u63cf\u8ff0"}],children:Object(f.jsx)(P.a,{})}),Object(f.jsx)(D.a.List,{name:"options",initialValue:["",""],children:function(e,t,n){var r=t.add,c=t.remove;n.errors;return Object(f.jsxs)(f.Fragment,{children:[e.map((function(t,n){return Object(f.jsxs)(D.a.Item,{label:0===n?"Options":"",required:!1,children:[Object(f.jsx)(D.a.Item,Object(v.a)(Object(v.a)({},t),{},{noStyle:!0,children:Object(f.jsx)(P.a,{placeholder:"option content",style:{width:"60%"}})}))," ",e.length>1?Object(f.jsx)(N.a,{className:"dynamic-delete-button",onClick:function(){return c(t.name)}}):null]},t.key)})),Object(f.jsx)(D.a.Item,{children:Object(f.jsx)(E.a,{type:"dashed",onClick:function(){return r()},style:{width:"60%"},icon:Object(f.jsx)(T.a,{}),children:"Add Option"})})]})}}),Object(f.jsx)(D.a.Item,{initialValue:A()().add(1,"days"),label:"DeadLine",name:"deadline",children:Object(f.jsx)(H.a,{format:"YYYY-MM-DD HH:mm",showTime:{format:"HH:mm"}})}),Object(f.jsx)(D.a.Item,{initialValue:!1,name:"anonymous",valuePropName:"checked",children:Object(f.jsx)(M.a,{children:"Anonymous"})}),Object(f.jsx)(D.a.Item,{initialValue:!1,name:"restricted",valuePropName:"checked",children:Object(f.jsx)(M.a,{children:"Restricted"})}),Object(f.jsx)(D.a.Item,{children:Object(f.jsx)(E.a,{type:"primary",htmlType:"submit",children:"Submit"})})]})}var q=n(136);function B(){var e=Object(r.useState)({row:[],count:10}),t=Object(m.a)(e,2),n=t[0],c=t[1],a=(function(){var e=Object(j.g)(),t=Object(h.c)((function(e){return e.user})),n=Object(h.c)((function(e){return e.triedLogin})),c=Object(h.b)();Object(r.useEffect)((function(){Object(u.a)(o.a.mark((function r(){return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!t){r.next=2;break}return r.abrupt("return");case 2:n&&e.push("/login"),t||c({type:"get-user-info"});case 4:case"end":return r.stop()}}),r)})))()}),[t,n])}(),Object(r.useState)([])),s=Object(m.a)(a,2),i=s[0],b=s[1];if(!i)return Object(f.jsx)("div",{children:"loading..."});function p(e){var t=e.key,n=e.index,r=e.style;return n>=i.length?Object(f.jsx)("div",{style:r,children:"loading..."},t):Object(f.jsx)("div",{style:r,children:Object(f.jsx)(l.b,{to:"/vote/"+i[n].id,children:i[n].title})},t)}return Object(f.jsx)("div",{children:Object(f.jsx)(q.a,{isRowLoaded:function(e){var t=e.index;return!!i[t]},loadMoreRows:function(e){var t=e.startIndex,n=e.stopIndex;return d.a.get("/vote/myvotes?startIndex=".concat(t,"&stopIndex=").concat(n)).then((function(e){c(e.data),i.splice.apply(i,[t,0].concat(Object(k.a)(e.data.rows))),b(Object(k.a)(i))})).catch((function(e){console.log(e)}))},rowCount:n.count,children:function(e){var t=e.onRowsRendered,r=e.registerChild;return Object(f.jsx)(q.b,{onRowsRendered:t,ref:r,width:300,height:300,rowCount:n.count,rowHeight:20,rowRenderer:p})}})})}var J=function(){Object(j.g)();var e=Object(h.b)(),t=Object(h.c)((function(e){return e.user}));function n(){return(n=Object(u.a)(o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e({type:"logout"});case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return Object(r.useEffect)((function(){e({type:"get-user-info"})}),[]),Object(f.jsx)(O.Provider,{value:{userInfo:t},children:Object(f.jsxs)("div",{className:"App",children:[t?Object(f.jsxs)(f.Fragment,{children:[Object(f.jsxs)("span",{children:["\u6b22\u8fce,",t.name]}),Object(f.jsx)(l.c,{to:"/home",children:"\u521b\u5efa"}),Object(f.jsx)(l.c,{to:"/my",children:"\u6211\u7684"}),Object(f.jsx)("button",{onClick:function(){return n.apply(this,arguments)},children:"\u767b\u51fa"})]}):Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)(l.c,{to:"/login",children:"\u767b\u5f55"}),Object(f.jsx)(l.c,{to:"/register",children:"\u6ce8\u518c"})]}),Object(f.jsxs)(j.d,{children:[Object(f.jsx)(j.b,{path:"/",exact:!0,children:Object(f.jsx)(j.a,{to:"/home"})}),Object(f.jsx)(j.b,{path:"/home",component:w}),Object(f.jsx)(j.b,{path:"/login",component:x}),Object(f.jsx)(j.b,{path:"/register",component:y}),Object(f.jsx)(j.b,{path:"/create",component:Y}),Object(f.jsx)(j.b,{path:"/my",component:B}),Object(f.jsx)(j.b,{path:"/vote/:id",children:Object(f.jsx)(r.Suspense,{fallback:"loading...",children:Object(f.jsx)(U,{})})})]})]})})},G=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,360)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,a=t.getLCP,s=t.getTTFB;n(e),r(e),c(e),a(e),s(e)}))},z=n(135),K=n(194),Q=n(68),W=o.a.mark(ne),X=o.a.mark(re),Z=o.a.mark(ce),$=o.a.mark(ae),_=Object(K.a)(),ee={user:null,votes:{},triedLogin:!1},te=Object(z.b)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ee,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"user-info":return Object(v.a)(Object(v.a)({},e),{},{user:t.user});case"remove-user-info":return Object(v.a)(Object(v.a)({},e),{},{user:null});case"try-login-failed":return Object(v.a)(Object(v.a)({},e),{},{triedLogin:!0});default:return e}}),Object(z.a)(_));function ne(e){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.a.get("/account/userinfo");case 3:return t=e.sent,e.next=6,Object(Q.a)({type:"user-info",user:t.data});case 6:e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(0),e.next=12,Object(Q.a)({type:"try-login-failed"});case 12:case"end":return e.stop()}}),W,null,[[0,8]])}function re(e){var t;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,d.a.post("/account/login",{name:e.name,password:e.password});case 3:return t=n.sent,n.next=6,Object(Q.a)({type:"user-info",user:t.data});case 6:n.next=11;break;case 8:throw n.prev=8,n.t0=n.catch(0),n.t0;case 11:case"end":return n.stop()}}),X,null,[[0,8]])}function ce(e){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.get("/account/logout");case 2:return e.sent,e.next=5,Object(Q.a)({type:"remove-user-info"});case 5:case"end":return e.stop()}}),Z)}function ae(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Q.b)("get-user-info",ne);case 2:return e.next=4,Object(Q.b)("login",re);case 4:return e.next=6,Object(Q.b)("logout",ce);case 6:case"end":return e.stop()}}),$)}_.run(ae);n(348);s.a.render(Object(f.jsx)(c.a.StrictMode,{children:Object(f.jsx)(l.a,{children:Object(f.jsx)(h.a,{store:te,children:Object(f.jsx)(J,{})})})}),document.getElementById("root")),G()}},[[349,1,2]]]);
//# sourceMappingURL=main.0cbf58c1.chunk.js.map